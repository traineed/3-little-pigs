<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Little Red Hen: Baking Bread</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap');
        
        body {
            font-family: 'Open Sans', sans-serif;
            touch-action: manipulation;
            overflow: hidden;
            background-color: #fff7ed;
        }

        .hen-walk {
            animation: waddle 1s infinite ease-in-out;
        }

        @keyframes waddle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .steam {
            animation: steamRise 2s infinite;
            opacity: 0;
        }

        @keyframes steamRise {
            0% { transform: translateY(0); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .sound-label {
            position: absolute;
            font-weight: 800;
            color: #ea580c;
            background: white;
            padding: 4px 12px;
            border-radius: 8px;
            border: 2px solid #ea580c;
            pointer-events: none;
            z-index: 100;
            animation: popIn 0.5s forwards;
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .dough-pulse {
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
    </style>
</head>
<body class="bg-orange-50">

    <div id="game-container" class="relative w-full h-screen flex flex-col items-center justify-center p-4">
        
        <!-- Header / Visual Schedule -->
        <div class="absolute top-4 left-4 flex gap-4 items-center">
            <div class="flex gap-2 items-center bg-white/80 p-2 rounded-full shadow-sm border border-orange-200">
                <span class="text-2xl">üêî</span>
                <div id="progress-dots" class="flex gap-1">
                    <!-- Dots generated by JS -->
                </div>
            </div>

            <button id="volume-toggle" onclick="toggleVolume()" class="bg-white/80 p-2 rounded-full border border-gray-200 flex items-center gap-2 shadow-sm">
                <span id="volume-icon">üîä</span>
                <span id="volume-text" class="text-xs font-bold mr-1">LOW</span>
            </button>
        </div>

        <!-- Emotion Indicator -->
        <div id="emotion-indicator" class="absolute top-4 right-4 bg-white p-3 rounded-xl shadow-md border-2 border-orange-400 flex flex-col items-center">
            <span id="emotion-emoji" class="text-4xl">üêî</span>
            <span id="emotion-text" class="text-xs font-bold uppercase mt-1 text-gray-600">Busy</span>
        </div>

        <!-- Main Content Area -->
        <div id="scene-content" class="w-full max-w-2xl text-center"></div>

        <!-- Bottom Controls -->
        <div id="controls" class="absolute bottom-8 w-full flex justify-center gap-4 px-4"></div>

    </div>

    <div id="sound-cue-layer" class="fixed inset-0 pointer-events-none z-50"></div>

    <!-- Feedback Modal -->
    <div id="message-box" class="fixed inset-0 bg-black/40 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm border-4 border-orange-400">
            <h2 id="msg-title" class="text-3xl font-bold mb-4">Well Done!</h2>
            <p id="msg-body" class="text-xl mb-6">Text goes here.</p>
            <button onclick="closeMessage()" class="bg-orange-500 text-white px-8 py-4 rounded-2xl text-2xl font-bold shadow-lg active:scale-95">
                Next
            </button>
        </div>
    </div>

    <script>
        const state = {
            step: 0,
            volume: 'low',
            audioCtx: null
        };

        function initAudio() {
            if (!state.audioCtx) {
                state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (state.volume === 'off') return;
            initAudio();
            const ctx = state.audioCtx;
            const vol = state.volume === 'low' ? 0.05 : 0.15;

            if (type === 'cluck') {
                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.1);
                g.gain.setValueAtTime(vol, ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                osc.connect(g); g.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.15);
            }
            if (type === 'water') {
                const noise = ctx.createBufferSource();
                const buffer = ctx.createBuffer(1, ctx.sampleRate, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for(let i=0; i<ctx.sampleRate; i++) data[i] = Math.random() * 2 - 1;
                noise.buffer = buffer;
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass'; filter.frequency.value = 1000;
                const g = ctx.createGain();
                g.gain.setValueAtTime(vol, ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, ctx.currentTime + 1);
                noise.connect(filter); filter.connect(g); g.connect(ctx.destination);
                noise.start();
            }
            if (type === 'snip') {
                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.05);
                g.gain.setValueAtTime(vol, ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.connect(g); g.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.1);
            }
            if (type === 'grind') {
                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(60, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(40, ctx.currentTime + 0.5);
                g.gain.setValueAtTime(vol, ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.5);
                osc.connect(g); g.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.5);
            }
            if (type === 'squish') {
                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(100, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
                g.gain.setValueAtTime(vol, ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.connect(g); g.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.3);
            }
            if (type === 'bake') {
                const notes = [800, 1000];
                notes.forEach((f, i) => {
                    const osc = ctx.createOscillator();
                    const g = ctx.createGain();
                    osc.frequency.setValueAtTime(f, ctx.currentTime + i*0.1);
                    g.gain.setValueAtTime(vol, ctx.currentTime + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i*0.1 + 0.2);
                    osc.connect(g); g.connect(ctx.destination);
                    osc.start(ctx.currentTime + i*0.1); osc.stop(ctx.currentTime + i*0.1 + 0.2);
                });
            }
        }

        function showCue(txt) {
            const el = document.createElement('div');
            el.className = 'sound-label';
            el.innerText = `[${txt}]`;
            el.style.left = (Math.random() * 40 + 30) + '%';
            el.style.top = (Math.random() * 20 + 40) + '%';
            document.getElementById('sound-cue-layer').appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function toggleVolume() {
            if (state.volume === 'low') state.volume = 'high';
            else if (state.volume === 'high') state.volume = 'off';
            else state.volume = 'low';
            
            document.getElementById('volume-icon').innerText = state.volume === 'off' ? 'üîá' : (state.volume === 'high' ? 'üîä' : 'üîâ');
            document.getElementById('volume-text').innerText = state.volume.toUpperCase();
            playSound('cluck');
        }

        const scenes = [
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <div class="hen-walk text-9xl mb-8">üêî</div>
                        <h1 class="text-4xl font-bold text-orange-800 mb-4">The Little Red Hen</h1>
                        <p class="text-xl text-orange-600 font-bold uppercase tracking-widest">"Who will help me?"</p>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="nextStep()" class="bg-orange-500 text-white px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           Start Story
                        </button>
                    `;
                    updateEmotion('üêî', 'Busy');
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <h2 class="text-3xl font-bold text-orange-800 mb-8">Planting the Seeds</h2>
                        <div class="flex flex-col items-center">
                            <div id="plant-container" class="relative w-64 h-64 bg-amber-900 rounded-t-full border-b-8 border-amber-950 overflow-hidden flex items-end justify-center">
                                <div id="wheat-grow" class="text-8xl transition-all duration-2000 transform translate-y-20">üåæ</div>
                            </div>
                            <p class="mt-4 text-amber-700 font-bold italic">Water the seeds!</p>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="growWheat()" class="bg-blue-500 text-white px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           üíß Water
                        </button>
                    `;
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <h2 class="text-3xl font-bold text-orange-800 mb-8">Cutting the Wheat</h2>
                        <div class="flex flex-col items-center">
                            <div class="text-9xl mb-4">üåæ</div>
                            <div class="text-7xl">‚úÇÔ∏è</div>
                            <p class="mt-4 text-orange-700 font-bold italic">Snip the wheat!</p>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="cutWheat()" class="bg-orange-400 text-white px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           ‚úÇÔ∏è Snip!
                        </button>
                    `;
                    updateEmotion('üåæ', 'Harvesting');
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <h2 class="text-3xl font-bold text-orange-800 mb-8">Grinding the Wheat</h2>
                        <div class="flex flex-col items-center">
                            <div class="flex gap-4 mb-4">
                                <div id="seed-bits" class="text-6xl">ü•ú</div>
                                <div class="text-8xl">‚öôÔ∏è</div>
                            </div>
                            <p class="mt-4 text-gray-700 font-bold italic">Grind into flour!</p>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="grindWheat()" class="bg-stone-500 text-white px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           ‚öôÔ∏è Grind
                        </button>
                    `;
                    updateEmotion('üí™', 'Working');
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <h2 class="text-3xl font-bold text-orange-800 mb-8">Kneading the Dough</h2>
                        <div class="flex flex-col items-center">
                            <div id="dough-ball" class="text-9xl mb-4 bg-orange-100 rounded-full p-4 border-4 border-orange-200">ü•£</div>
                            <p class="mt-4 text-orange-900 font-bold italic">Push and squish!</p>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="kneadDough()" class="bg-orange-200 text-orange-900 border-4 border-orange-400 px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           ‚úã Squish!
                        </button>
                    `;
                    updateEmotion('ü•£', 'Mixing');
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <h2 class="text-3xl font-bold text-orange-800 mb-8">Baking the Bread</h2>
                        <div class="relative flex flex-col items-center">
                            <div class="text-9xl mb-4">‚è≤Ô∏è</div>
                            <div class="text-4xl font-bold text-orange-500">Wait for the bell...</div>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="bakeBread()" class="bg-orange-600 text-white px-10 py-5 rounded-3xl text-3xl font-bold shadow-xl active:scale-95">
                           üî• Bake!
                        </button>
                    `;
                    updateEmotion('üë©‚Äçüç≥', 'Baking');
                }
            },
            {
                setup: () => {
                    document.getElementById('scene-content').innerHTML = `
                        <div class="flex flex-col items-center">
                            <div class="text-9xl mb-2">üçû</div>
                            <div class="flex gap-2 mb-8">
                                <span class="steam text-2xl">‚ô®Ô∏è</span>
                                <span class="steam text-2xl" style="animation-delay: 0.5s">‚ô®Ô∏è</span>
                            </div>
                            <h2 class="text-4xl font-bold text-green-700">Yum!</h2>
                            <p class="text-xl text-gray-600 mt-4 font-bold italic">The bread is finished!</p>
                        </div>
                    `;
                    document.getElementById('controls').innerHTML = `
                        <button onclick="resetGame()" class="bg-green-600 text-white px-8 py-4 rounded-2xl text-2xl font-bold shadow-lg">
                           Play Again
                        </button>
                    `;
                    updateEmotion('üòã', 'Happy');
                }
            }
        ];

        function updateEmotion(emo, txt) {
            document.getElementById('emotion-emoji').innerText = emo;
            document.getElementById('emotion-text').innerText = txt;
        }

        function growWheat() {
            playSound('water');
            showCue('SPLASH');
            document.getElementById('wheat-grow').style.transform = 'translateY(0)';
            setTimeout(() => {
                showMessage("It Grew!", "The golden wheat is tall. Let's harvest it!", () => {
                    nextStep();
                });
            }, 1000);
        }

        function cutWheat() {
            playSound('snip');
            showCue('SNIP');
            showMessage("Cut!", "You cut the wheat. It is sharp and dry.", () => {
                nextStep();
            });
        }

        function grindWheat() {
            playSound('grind');
            showCue('CRUNCH');
            showMessage("Flour!", "The seeds are crushed into soft white flour.", () => {
                nextStep();
            });
        }

        function kneadDough() {
            playSound('squish');
            showCue('SQUISH');
            document.getElementById('dough-ball').classList.add('dough-pulse');
            setTimeout(() => {
                showMessage("Sticky!", "The dough is stretchy and soft. Time to bake!", () => {
                    nextStep();
                });
            }, 1000);
        }

        function bakeBread() {
            playSound('bake');
            showCue('DING!');
            showMessage("Ready!", "The bread smells warm and yummy.", () => {
                nextStep();
            });
        }

        function updateUI() {
            scenes[state.step].setup();
            const dotsContainer = document.getElementById('progress-dots');
            dotsContainer.innerHTML = '';
            for(let i=0; i<scenes.length; i++) {
                const dot = document.createElement('div');
                dot.className = `w-3 h-3 rounded-full ${i <= state.step ? 'bg-orange-500' : 'bg-gray-300'}`;
                dotsContainer.appendChild(dot);
            }
        }

        function nextStep() {
            state.step++;
            if (state.step >= scenes.length) state.step = 0;
            updateUI();
        }

        function resetGame() {
            state.step = 0;
            updateUI();
        }

        let currentMsgCallback = null;
        function showMessage(title, body, callback) {
            document.getElementById('msg-title').innerText = title;
            document.getElementById('msg-body').innerText = body;
            document.getElementById('message-box').classList.remove('hidden');
            currentMsgCallback = callback;
        }

        function closeMessage() {
            document.getElementById('message-box').classList.add('hidden');
            if (currentMsgCallback) currentMsgCallback();
        }

        window.onload = updateUI;
    </script>
</body>
</html>
